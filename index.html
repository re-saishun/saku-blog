<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Scraper Blog Sakurazaka46 (Tag Mentah + Terjemahan + Romaji)</title>
<script src="https://unpkg.com/wanakana"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
    height: 100vh;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: url('https://github.com/ReMineral/saku-blog/blob/main/5th_TOUR_2025%2013.jpg?raw=true') center/cover no-repeat;
    position: relative;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body::before {
    content: "";
    position: absolute;
    top:0;
    left:0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
    z-index: 0;
}

.container-scraper {
    position: relative;
    z-index: 1;
    max-width: 900px;
    width: 90%;
    background: rgba(255,255,255,0.95);
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

h2 { margin-bottom: 20px; color: #0984e3; display: flex; justify-content: center;}
h3 { margin-top: 30px; margin-bottom: 10px; color: #6c5ce7; }

input {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    border: 1px solid #dfe6e9;
    border-radius: 8px;
    margin-bottom: 10px;
    transition: all 0.2s;
}
input:focus { border-color: #0984e3; outline: none; box-shadow: 0 0 5px rgba(0,123,255,0.3); }

button {
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    width: 100%;
    background: #00b894;
    color: #fff;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 20px;
}
button:hover { background: #019875; }

#resultFinal {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
}

pre {
    background: #f1f2f6;
    padding: 15px;
    border-radius: 8px;
    overflow-x: auto;
    overflow-y: auto;
    max-height: 600px;
    white-space: pre-wrap;
    word-break: break-word;
    font-size: 14px;
    margin-top: 10px;
}

#resultFinal button {
    margin-bottom: 10px;
}

@media(max-width: 600px){
    input, button { font-size: 14px; padding: 10px; }
    pre { font-size: 13px; }
}
</style>
</head>
<body>

<div class="container-scraper">
  <h2>SAKAMICHI ARTICLE GRABBER</h2>

  <input id="urlInput" placeholder="Tempel link blog Sakurazaka46 di sini">
  <button onclick="scrape()">Ambil Artikel</button>

  <div id="resultFinal"></div>
</div>

<script>
let articleLines = [];

// ------------------- Scrape -------------------
async function scrape() {
    const url = document.getElementById("urlInput").value;
    if (!url) return alert("Masukkan URL dulu!");
    document.getElementById("resultFinal").innerHTML = `<div class="text-secondary">Mengambil data...</div>`;

    try {
        const proxyURL = "https://api.allorigins.win/get?url=" + encodeURIComponent(url);
        const res = await fetch(proxyURL);
        const data = await res.json();

        const parser = new DOMParser();
        const doc = parser.parseFromString(data.contents, "text/html");
        const article = doc.querySelector("div.box-article");
        if (!article) {
            document.getElementById("resultFinal").innerHTML = `<div class="text-danger">Tidak menemukan box-article</div>`;
            return;
        }

        let html = article.innerHTML;
        html = html.replace(/<img\s+src="(\/[^"]*)"/g, '<img src="https://sakurazaka46.com$1"');

        articleLines = html
            .split(/(<br\s*\/?>)/i)
            .map(line => line.trim())
            .filter(line => line.length > 0);

        await buildOutputFinal();

    } catch (err) {
        document.getElementById("resultFinal").innerHTML = `<div class="text-danger">Error: ${err.message}</div>`;
    }
}

// ------------------- OUTPUT FINAL -------------------
async function buildOutputFinal() {

    async function geminiCall(prompt) {
        try {
            const res = await fetch(
                "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyD9HGZ6pIVouEgiaTS_dFnVod-kafD0RWk",
                {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                }
            );
            const data = await res.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text || "";
        } 
        catch (err) {
            return "(error AI)";
        }
    }

    let textBlocks = [];
    let escapedBlocks = [];

    for (let line of articleLines) {
        const escapedLine = line
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;");

        const textOnly = line.replace(/<[^>]+>/g, "").trim();
        if (!textOnly) continue;

        escapedBlocks.push(escapedLine);
        textBlocks.push(textOnly);
    }

    // -----------------------------
    // PROMPT JSON (Fix Output Kosong)
    // -----------------------------
    const prompt =
`Saya memberikan daftar teks Jepang. Untuk setiap baris, berikan output dalam format JSON seperti berikut:

[
  {
    "romaji": "....",
    "indo": "...."
  }
]

JANGAN beri teks di luar JSON.

Daftar teks:
${textBlocks.join("\n")}`;

    const aiOutput = await geminiCall(prompt);

    // -----------------------------
    // PARSE JSON AI
    // -----------------------------
    let parsed = [];
    try {
        parsed = JSON.parse(aiOutput);
    } catch (e) {
        console.log("AI Output tidak sesuai JSON:", aiOutput);
        alert("Gagal parse JSON. Periksa console.");
        return;
    }

    // -----------------------------
    // Gabungkan escaped + romaji + indo
    // -----------------------------
    const finalLines = parsed.map((obj, i) => {
        return `${escapedBlocks[i]}\n${obj.romaji}\n${obj.indo}\n`;
    });

    // -----------------------------
    // Tampilkan output
    // -----------------------------
    document.getElementById("resultFinal").innerHTML = `
        <h3 class="text-purple">OUTPUT â€” Jepang + Romaji + Terjemahan</h3>
        <button onclick="copyFinal()" class="btn btn-primary mb-2">Copy</button>
        <div class="card p-3">
            <pre id="finalContent" class="mb-0"></pre>
        </div>
    `;

    document.getElementById("finalContent").textContent = finalLines.join("\n");
}

function copyFinal() {
    const content = document.getElementById("finalContent").textContent;
    navigator.clipboard.writeText(content)
        .then(() => alert("Copied!"));
}
</script>

</body>
</html>
