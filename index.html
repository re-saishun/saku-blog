<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Scraper Blog Sakurazaka46 (Tag Mentah + Terjemahan + Romaji)</title>
<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
/* --- Background Image & Centering --- */
body {
    height: 100%;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: url('https://github.com/ReMineral/saku-blog/blob/main/5th_TOUR_2025%2013.jpg?raw=true') center/cover no-repeat;
    position: relative;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body::before {
    content: "";
    position: absolute;
    top:0;
    left:0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
    z-index: 0;
}

/* --- Container --- */
.container-scraper {
    position: relative;
    z-index: 1;
    max-width: 900px;
    width: 90%;
    background: rgba(255,255,255,0.95);
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

h2 { margin-bottom: 20px; color: #0984e3; display: flex; justify-content: center;}
h3 { margin-top: 30px; margin-bottom: 10px; color: #6c5ce7; }

input {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    border: 1px solid #dfe6e9;
    border-radius: 8px;
    margin-bottom: 10px;
    transition: all 0.2s;
}
input:focus { border-color: #0984e3; outline: none; box-shadow: 0 0 5px rgba(0,123,255,0.3); }

button {
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    width: 100%;
    background: #00b894;
    color: #fff;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 20px;
}
button:hover { background: #019875; }

.text-danger { display: flex; justify-content: center; }

/* Output Container */
#outputWrapper {
    position: relative;
}
    /* LOADING SPINNER */
#loadingAI {
    display: none;
    margin: 15px 0;
    text-align: center;
    font-size: 15px;
    color: #6c5ce7;
}

.spinner {
    width: 32px;
    height: 32px;
    border: 4px solid #dcdde1;
    border-top-color: #6c5ce7;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 10px auto;
}

@keyframes spin {
    from { transform: rotate(0); }
    to { transform: rotate(360deg); }
}


/* Tombol Full Size */
#fullBtn {
    width: 100%;
    padding: 8px 12px;
    background: #6c5ce7;
    border: none;
    color: white;
    border-radius: 8px;
    margin-top: 8px;
    cursor: pointer;
}
#fullBtn:hover {
    background: #5b4ad6;
}

/* PRE BOX KECIL DENGAN FULL MODE */
#finalContent {
    background: #f1f2f6;
    padding: 15px;
    border-radius: 8px;
    overflow-x: auto;
    overflow-y: auto;
    max-height: 200px;            /* KOTAK KECIL */
    white-space: pre-wrap;
    word-break: break-word;
    font-size: 14px;
    transition: max-height 0.25s ease;
}

/* FULLSCREEN MODE */
#finalContent.full {
    max-height: 80vh;             /* BESAR LAYAR */
}

@media(max-width: 600px){
    input, button { font-size: 14px; padding: 10px; }
    pre { font-size: 13px; }
}
</style>
</head>
<body>

<div class="container-scraper">
  <h2>SAKAMICHI ARTICLE GRABBER</h2>
  <input id="urlInput" placeholder="Tempel link blog Sakurazaka46 di sini">
  <button onclick="scrape()">Ambil Artikel</button>
  <div id="loadingAI">
    <div class="spinner"></div>
    Menerjemahkan... mohon tunggu sebentar ya üí´
</div>

<div id="resultFinal"></div>

</div>

<script>
let articleLines = [];

/* =====================
   SCRAPE
=====================*/
async function scrape() {
    const url = document.getElementById("urlInput").value;
    if (!url) return alert("Masukkan URL dulu!");

    document.getElementById("resultFinal").innerHTML =
        `<div class="text-secondary">Mengambil data...</div>`;

    try {
        const proxyURL = "https://cors-proxy1.vercel.app/api/fetch?url=" + encodeURIComponent(url);
        const res = await fetch(proxyURL);
        const htmlText = await res.text();

        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlText, "text/html");
        const article = doc.querySelector("div.box-article");

        if (!article) {
            document.getElementById("resultFinal").innerHTML =
                `<div class="text-danger">Tidak menemukan box-article</div>`;
            return;
        }

        // perbaiki src image relatif
        let html = article.innerHTML.replace(/src="\/([^"]*)"/g, 'src="https://sakurazaka46.com/$1"');

        // pecah berdasarkan <br> tetapi TAG TIDAK DIHAPUS
        articleLines = html.split(/(<br\s*\/?>)/i).filter(l => l.trim().length > 0);

        await buildOutputFinal();

    } catch (err) {
        document.getElementById("resultFinal").innerHTML =
            `<div class="text-danger">Error: ${err.message}</div>`;
    }
}

/* =====================
   GEMINI CALL FIX
=====================*/
async function geminiCall(prompt) {
    try {
        const res = await fetch("https://cors-proxy1.vercel.app/api/gemini", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt })
        });

        const data = await res.json();

        // extractor FORMAT BARU GEMINI 2.x
        const text = data?.candidates?.[0]?.content?.parts?.[0]?.text;
        return text || "(AI-gagal)";
    } catch (err) {
        return "(AI-gagal)";
    }
}

/* =====================
   BUILD OUTPUT
=====================*/
async function buildOutputFinal() {
    const finalOut = [];
    showLoading();  // ‚Üê tampilkan loading

    for (let raw of articleLines) {
        let original = raw;           // versi asli (ada tag)
        let clean = raw.replace(/<[^>]+>/g, "").trim(); // teks murni

        // kalau tidak ada huruf Jepang ‚Üí jangan diproses AI
        if (!/[\u3040-\u30ff\u4e00-\u9faf]/.test(clean)) {
            finalOut.push(original);
            continue;
        }

        const prompt = `
Konversikan teks Jepang berikut menjadi ROMAJI dan TERJEMAHAN Indonesia.
Sangat penting: Jangan ubah kalimat. Jangan tambahkan kata lain.
Jawab ringkas sesuai format.

ROMAJI:
<romaji>
TERJEMAHAN:
<terjemahan>

Teks:
${clean}
`;

        const ai = await geminiCall(prompt);

        let romaji = ai.match(/ROMAJI:\s*([\s\S]*?)TERJEMAHAN:/);
        let indo   = ai.match(/TERJEMAHAN:\s*([\s\S]*)/);

        romaji = romaji ? romaji[1].trim() : "";
        indo   = indo ? indo[1].trim() : "";

        const merged = `
${original}
<br><span class="romaji">[ROMAJI] ${romaji}</span>
<br><span class="indo">[ID] ${indo}</span>
`;

        finalOut.push(merged);
    }

        document.getElementById("resultFinal").innerHTML = `
        <h3 class="text-purple">OUTPUTnya, Silakan sayang~~ </h3>
        <button onclick="copyFinal()" class="btn btn-primary mb-2">Copy</button>

        <div id="outputWrapper">
            <pre id="finalContent" class="mb-1"></pre>
            <button id="fullBtn" onclick="toggleFull()">Full Size</button>
        </div>
    `;

    hideLoading(); // ‚Üê hilangkan loading
    document.getElementById("finalContent").textContent = finalOut.join("\n");
}

    document.getElementById("finalContent").textContent = finalOut.join("\n");
}

/* =====================
   COPY
=====================*/
function copyFinal() {
    navigator.clipboard.writeText(
        document.getElementById("finalContent").textContent
    ).then(() => alert("Copied!"));
}

/* =====================
   FULL SIZE TOGGLE
=====================*/
function toggleFull() {
    const box = document.getElementById("finalContent");
    const btn = document.getElementById("fullBtn");

    box.classList.toggle("full");

    btn.textContent = box.classList.contains("full")
        ? "Kecilkan"
        : "Full Size";
}
    function showLoading() {
    document.getElementById("loadingAI").style.display = "block";
}

function hideLoading() {
    document.getElementById("loadingAI").style.display = "none";
}

</script>

</body>
</html>
