<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Scraper Blog Sakurazaka46 (Tag Mentah + Terjemahan + Romaji)</title>
<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
/* --- Background Image & Centering --- */
body {
    height: 100vh;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: url('https://github.com/ReMineral/saku-blog/blob/main/5th_TOUR_2025%2013.jpg?raw=true') center/cover no-repeat;
    position: relative;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body::before {
    content: "";
    position: absolute;
    top:0;
    left:0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
    z-index: 0;
}

/* --- Container --- */
.container-scraper {
    position: relative;
    z-index: 1;
    max-width: 900px;
    width: 90%;
    background: rgba(255,255,255,0.95);
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}

h2 { margin-bottom: 20px; color: #0984e3; display: flex; justify-content: center;}
h3 { margin-top: 30px; margin-bottom: 10px; color: #6c5ce7; }

input {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    border: 1px solid #dfe6e9;
    border-radius: 8px;
    margin-bottom: 10px;
    transition: all 0.2s;
}
input:focus { border-color: #0984e3; outline: none; box-shadow: 0 0 5px rgba(0,123,255,0.3); }

button {
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    width: 100%;
    background: #00b894;
    color: #fff;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 20px;
}
button:hover { background: #019875; }

#resultFinal {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
}

pre {
    background: #f1f2f6;
    padding: 15px;
    border-radius: 8px;
    overflow-x: auto;
    overflow-y: auto;
    max-height: 600px;
    white-space: pre-wrap;
    word-break: break-word;
    font-size: 14px;
    margin-top: 10px;
}

.text-danger { display: flex; justify-content: center; }

#resultFinal button { margin-bottom: 10px; }

@media(max-width: 600px){
    input, button { font-size: 14px; padding: 10px; }
    pre { font-size: 13px; }
}
</style>
</head>
<body>

<div class="container-scraper">
  <h2>SAKAMICHI ARTICLE GRABBER</h2>
  <input id="urlInput" placeholder="Tempel link blog Sakurazaka46 di sini">
  <button onclick="scrape()">Ambil Artikel</button>
  <div id="resultFinal"></div>
</div>

<script>
let articleLines = [];

// ------------------- Scrape -------------------
async function scrape() {
    const url = document.getElementById("urlInput").value;
    if (!url) return alert("Masukkan URL dulu!");
    document.getElementById("resultFinal").innerHTML = `<div class="text-secondary">Mengambil data...</div>`;

    try {
        // pakai proxy cors-proxy1.vercel.app
        const proxyURL = "https://cors-proxy1.vercel.app/api/fetch?url=" + encodeURIComponent(url);
        const res = await fetch(proxyURL);
        const htmlText = await res.text();

        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlText, "text/html");
        const article = doc.querySelector("div.box-article");
        if (!article) {
            document.getElementById("resultFinal").innerHTML = `<div class="text-danger">Tidak menemukan box-article</div>`;
            return;
        }

        let html = article.innerHTML;
        html = html.replace(/<img\s+src="(\/[^"]*)"/g, '<img src="https://sakurazaka46.com$1"');

        articleLines = html
            .split(/(<br\s*\/?>)/i)
            .map(line => line.trim())
            .filter(line => line.length > 0);

        await buildOutputFinal();

    } catch (err) {
        document.getElementById("resultFinal").innerHTML = `<div class="text-danger">Error: ${err.message}</div>`;
    }
}

// ------------------- OUTPUT FINAL (batch via proxy) -------------------
async function buildOutputFinal() {

    async function geminiCall(prompt) {
        try {
            // proxy Gemini via cors-proxy1
            const proxyURL = "https://cors-proxy1.vercel.app/api/gemini";
            const res = await fetch(proxyURL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ prompt })
            });
            const data = await res.json();
            return data.text || "(error AI)";
        } catch (err) {
            return "(error AI)";
        }
    }

    const finalLines = [];
    const batchSize = 10; // jumlah baris per request

    for (let i = 0; i < articleLines.length; i += batchSize) {
        const batch = articleLines.slice(i, i + batchSize)
            .map(l => l.replace(/<[^>]+>/g, "").trim())
            .filter(l => l.length > 0)
            .join("\n");

        if (!batch) continue;

        const prompt = `
Ubah teks Jepang berikut menjadi ROMAJI dan TERJEMAHAN bahasa Indonesia. Terjemahannya dengan konteks semua informasi dari isi blognya, dengan bahasa yang tidak terlalu kaku, sdikit kasual tapi masih enak dibaca
Format output:
ROMAJI:
<romaji>
TERJEMAHAN:
<terjemahan>

Teks:
${batch}
`;

        const result = await geminiCall(prompt);

        const entries = result.split(/\n(?=ROMAJI:|TERJEMAHAN:)/)
                              .map(s => s.trim())
                              .filter(s => s.length > 0);

        finalLines.push(...entries);
    }

    document.getElementById("resultFinal").innerHTML = `
        <h3 class="text-purple">OUTPUT â€” Romaji + Terjemahan</h3>
        <button onclick="copyFinal()" class="btn btn-primary mb-2">Copy</button>
        <div class="card p-3">
            <pre id="finalContent" class="mb-0"></pre>
        </div>
    `;
    document.getElementById("finalContent").textContent = finalLines.join("\n\n");
}

// Copy
function copyFinal() {
    const content = document.getElementById("finalContent").textContent;
    navigator.clipboard.writeText(content).then(() => alert("Copied!"));
}
</script>

</body>
</html>
