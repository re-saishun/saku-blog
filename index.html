<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Scraper Blog Sakurazaka46 via Proxy</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
#progressContainer { width: 80%; margin-bottom: 10px; }
#output { width: 100%; height: 500px; overflow: auto; border: 1px solid #ccc; padding: 10px; white-space: pre-wrap; background: #f9f9f9; }
button { margin-bottom: 10px; }
input { margin-bottom: 10px; padding: 5px; width: 80%; }
</style>
</head>
<body>

<h2>Scraper Blog Sakurazaka46 (via Proxy)</h2>
<input type="text" id="blogUrl" placeholder="Masukkan URL blog" />
<br/>
<div id="progressContainer">
  <progress id="progressBar" value="0" max="100" style="width: 100%;"></progress>
</div>
<button id="startBtn">Mulai Scrape</button>
<button id="copyBtn">Copy Output</button>
<div id="output">Hasil akan muncul di sini...</div>

<script>
const PROXY_BLOG = "https://cors-proxy1.vercel.app/api/proxy?url=";        // Proxy untuk blog
const PROXY_TRANSLATE = "https://cors-proxy1.vercel.app/api/translate";   // Proxy untuk AI Gemini

// Fetch terjemahan melalui proxy server (menghindari CORS)
async function translateText(text) {
    try {
        const res = await fetch(PROXY_TRANSLATE, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text })
        });
        const data = await res.json();
        return data.predictions?.[0]?.content || "[Terjemahan gagal]";
    } catch (err) {
        console.error(err);
        return "[Terjemahan gagal]";
    }
}

// Perbaiki link gambar relatif
function fixImageLinks(html) {
    return html.replace(/<img\s+[^>]*src="(?!https?:\/\/)([^"]+)"/g, '<img src="https://sakurazaka46.com/$1"');
}

// Fungsi utama scraping blog
async function scrapeBlog(url) {
    const output = $("#output");
    const progressBar = $("#progressBar");
    output.text("Loading...");
    progressBar.val(0);

    try {
        const proxyUrl = PROXY_BLOG + encodeURIComponent(url);
        const res = await fetch(proxyUrl);
        if (!res.ok) throw new Error("Failed to fetch blog via proxy");

        const htmlText = await res.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlText, "text/html");

        const articles = doc.querySelectorAll(".box-article");
        if (articles.length === 0) {
            output.text("Tidak menemukan elemen <div class='box-article'>.");
            return;
        }

        let result = "";
        const total = articles.length;

        for (let i = 0; i < total; i++) {
            const htmlContent = fixImageLinks(articles[i].innerHTML);
            const jpText = articles[i].innerText.trim();

            // Update progress bar
            progressBar.val(((i + 1) / total) * 100);

            // Dapatkan romaji + terjemahan dari proxy translate
            const aiResult = await translateText(jpText);

            const combined = `
${htmlContent}
${aiResult}
---------------------------
`;
            result += combined;
        }

        output.text(result);
        progressBar.val(0); // reset setelah selesai

    } catch (err) {
        output.text("Error: " + err);
    }
}

// Tombol Mulai Scrape
$("#startBtn").click(() => {
    const url = $("#blogUrl").val().trim();
    if (url) scrapeBlog(url);
});

// Tombol Copy Output
$("#copyBtn").click(() => {
    const text = $("#output").text();
    navigator.clipboard.writeText(text).then(() => alert("Copied!"));
});
</script>
</body>
</html>
